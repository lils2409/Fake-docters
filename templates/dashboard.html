<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MedFlow Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      .step-circle {
        width: 32px;
        height: 32px;
        border-radius: 9999px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        background-color: #e5e7eb; /* gray-200 */
        color: #6b7280;           /* gray-500 */
        border: 2px solid #d1d5db;/* gray-300 */
        z-index: 10;
      }

      .step-label {
        color: #9ca3af; /* gray-400 */
        font-weight: 500;
      }

      .stepper-item.active .step-circle {
        background-color: #10b981; /* green-500 */
        border-color: #10b981;
        color: #ffffff;
      }

      .stepper-item.active .step-label {
        color: #059669; /* green-600 */
      }
    </style>

</head>

<body class="bg-[#EAF7F8] h-screen overflow-hidden flex font-sans">

<!-- SIDEBAR -->
<aside class="w-64 bg-[#7FCBC3] flex flex-col px-6 py-8 h-screen overflow-hidden">

    <!-- LOGO -->
    <h1 class="text-3xl font-bold text-blue-600 mb-10">
        MED<span class="text-teal-700">FLOW</span>
    </h1>

    <!-- NAV -->
    <nav class="space-y-4 flex-1">
        <button onclick="showPage('dashboard', this)"
            class="nav-btn bg-white shadow">
            <i data-lucide="home"></i> Dashboard
        </button>

        <button onclick="showPage('add', this)" class="nav-btn">
            <i data-lucide="user-plus"></i> Add Patient
        </button>

        <button onclick="showPage('edit', this)" class="nav-btn">
            <i data-lucide="user-pen"></i> Edit Patient
        </button>

        {% if role == "admin" %}
        <button onclick="window.location.href='/register'"
        class="nav-btn">
        <i data-lucide="user-cog"></i> Register User
        </button>
        {% endif %}

    </nav>

    <div class="border-t border-white/40 my-6"></div>

    <!-- LOGOUT -->
    <button onclick="showLogoutPopup()"
        class="flex items-center gap-3 text-red-600 font-semibold hover:bg-white/20 px-4 py-3 rounded-xl transition">
        <i data-lucide="log-out"></i> Log out
    </button>
</aside>

<!-- MAIN CONTENT -->
<main class="flex-1 p-6 overflow-y-auto">
<section class="bg-[#F6FBFC] rounded-3xl shadow-lg min-h-full p-8">

<!-- DASHBOARD -->
<div id="dashboard" class="page">
    <h2 class="text-2xl font-semibold mb-6">Dashboard</h2>

    <!-- TOP STATS -->
    <div class="grid grid-cols-3 gap-6 mb-10">
        <div class="bg-white rounded-2xl p-6 shadow">
            <p class="text-sm text-gray-500">Total Patients</p>
            <p id="totalPatients" class="text-4xl font-bold text-gray-900">0</p>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow">
            <p class="text-sm text-gray-500">Waiting</p>
            <p id="waitingPatients" class="text-4xl font-bold text-yellow-500">0</p>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow">
            <p class="text-sm text-gray-500">Completed</p>
            <p id="donePatients" class="text-4xl font-bold text-green-600">0</p>
        </div>
    </div>


    <!-- TRIAGE LEVELS -->
    
    <div class="space-y-8">

  <!-- TRIAGE OVERVIEW -->
  <div>
    <h3 class="text-xl font-semibold text-gray-700 mb-6">
      Triage Overview
    </h3>

    <div class="grid grid-cols-5 gap-6">

      <!-- WHITE -->
      <div class="triage-card border-l-4 border-gray-400 bg-white rounded-2xl shadow-sm p-6 cursor-pointer hover:shadow-md transition">
        <p class="text-sm text-gray-500">White</p>
        <p id="whiteCount" class="text-3xl font-bold text-gray-800 mt-2">0</p>
        <p class="text-xs text-gray-400 mt-1">Active Patients</p>
      </div>

      <!-- GREEN -->
      <div class="triage-card border-l-4 border-green-500 bg-white rounded-2xl shadow-sm p-6 cursor-pointer hover:shadow-md transition">
        <p class="text-sm text-gray-500">Green</p>
        <p id="greenCount" class="text-3xl font-bold text-gray-800 mt-2">0</p>
        <p class="text-xs text-gray-400 mt-1">Active Patients</p>
      </div>

      <!-- YELLOW -->
      <div class="triage-card border-l-4 border-yellow-400 bg-white rounded-2xl shadow-sm p-6 cursor-pointer hover:shadow-md transition">
        <p class="text-sm text-gray-500">Yellow</p>
        <p id="yellowCount" class="text-3xl font-bold text-gray-800 mt-2">0</p>
        <p class="text-xs text-gray-400 mt-1">Active Patients</p>
      </div>

      <!-- RED -->
      <div class="triage-card border-l-4 border-red-500 bg-white rounded-2xl shadow-sm p-6 cursor-pointer hover:shadow-md transition">
        <p class="text-sm text-gray-500">Red</p>
        <p id="redCount" class="text-3xl font-bold text-gray-800 mt-2">0</p>
        <p class="text-xs text-gray-400 mt-1">Active Patients</p>
      </div>

      <!-- BLACK -->
      <div class="triage-card border-l-4 border-black bg-white rounded-2xl shadow-sm p-6 cursor-pointer hover:shadow-md transition">
        <p class="text-sm text-gray-500">Black</p>
        <p id="blackCount" class="text-3xl font-bold text-gray-800 mt-2">0</p>
        <p class="text-xs text-gray-400 mt-1">Active Patients</p>
      </div>

    </div>
  </div>


  <!-- ACTIVE PATIENTS TABLE -->
  <div>
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-semibold text-gray-700">
        Active Patients
      </h3>

      <button class="text-sm text-gray-500 hover:text-gray-700">
        Show All
      </button>
    </div>

    <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
      <table class="w-full text-sm table-fixed">
        <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
          <tr>
            <th class="px-6 py-4 text-left">ID</th>
            <th class="px-6 py-4 text-left">Name</th>
            <th class="px-6 py-4 text-left">Sex</th>
            <th class="px-6 py-4 text-left">Age</th>
            <th class="px-6 py-4 text-left">Diagnosis</th>
            <th class="px-6 py-4 text-left">Status</th>
          </tr>
        </thead>

        <tbody id="activePatientsTable" class="divide-y text-gray-700"></tbody>
      </table>
    </div>
  </div>

</div>
</div>
        
    

<!-- ADD PATIENT -->
<div id="add" class="page hidden">
  <h2 class="text-2xl font-semibold mb-6">Add Patient</h2>
  <form method="POST" action="/add_patient"class="flex justify-center px-8 py-10" enctype="multipart/form-data">
  <div class="w-full max-w-6xl">
    <div class="flex gap-12">

      <!-- LEFT: Stepper -->
<aside class="w-56 pt-6">
  <div class="pl-6">

    <!-- STEP 1 -->
    <div class="stepper-item flex items-start gap-4" data-step="1">
      <div class="flex flex-col items-center">
        <div class="step-circle">1</div>
        <div class="w-px h-12 bg-gray-300"></div>
      </div>
      <span class="step-label mt-1">General</span>
    </div>

    <!-- STEP 2 -->
    <div class="stepper-item flex items-start gap-4" data-step="2">
      <div class="flex flex-col items-center">
        <div class="step-circle">2</div>
        <div class="w-px h-12 bg-gray-300"></div>
      </div>
      <span class="step-label mt-1">Medical</span>
    </div>

    <!-- STEP 3 (LAST – no line) -->
    <div class="stepper-item flex items-start gap-4" data-step="3">
      <div class="flex flex-col items-center">
        <div class="step-circle">3</div>
      </div>
      <span class="step-label mt-1">Triage</span>
    </div>

  </div>
</aside>

      <!-- RIGHT: Form -->
      <div class="flex-1 flex justify-center">
        <div class="w-full max-w-3xl bg-white rounded-2xl shadow p-8">

          <!-- STEP 1 -->
          <div class="step" data-step="1">
            <h3 class="font-semibold text-lg mb-6">General Information</h3>

            <div class="grid grid-cols-2 gap-4">
              <input name="patient_id" class="col-span-2 input" placeholder="Patient ID" required>
              <input name="name" class="input" placeholder="Name" required>

              <input name="surname" class="input" placeholder="Surname" required>
              <select name="sex" class="input" required>
                <option value="">Sex</option>
                <option>Male</option>
                <option>Female</option>
                <option>Other</option>
              </select>

              <input name="age" type="number" class="input" placeholder="Age" required>
              <input name="height" class="input" placeholder="Height (cm)" required>

              <input name="weight" class="input" placeholder="Weight (kg)" required>
            </div>

            <!-- Button -->
            <div class="flex justify-end mt-10">
              <button
                type="button"
                onclick="nextStep(1)"
                class="bg-teal-500 hover:bg-teal-400 text-white font-semibold px-8 py-3 rounded-xl shadow transition"
              >
                Next →
              </button>
            </div>
          </div>
          <!-- STEP 2 -->
    <div class="step hidden" data-step="2">
      <div class="bg-white rounded-2xl p-6 shadow">
        <h3 class="font-semibold mb-4">Medical Information</h3>

        <div class="grid grid-cols-2 gap-4">
          <input name="chronic_disease" class="input" required placeholder="Chronic Disease">
          <input name="allergy" class="input" required placeholder="Allergy">
          <input name="blood_pressure" class="input" required placeholder="Blood Pressure">
          <input name="heart_rate" class="input" required placeholder="Heart Rate">
          <input name="blood_type" class="input" required placeholder="Blood Type">
        </div>
          <textarea name="case_desc" class="input mt-4" rows="3" placeholder="Case Description"></textarea>
          <textarea name="diagnosis" class="input mt-4" rows="3" placeholder="Diagnosis"></textarea>          
        <div>
          <hr class="border-gray-200 my-3">
            <p class="font-medium mb-3">Imaging Required</p>

            <div class="flex gap-6">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="xray"
                      class="w-5 h-5 accent-blue-600">
                X - Ray
              </label>

              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="cbc"
                      class="w-5 h-5 accent-green-600">
                CBC
              </label>

              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="ct_scan"
                      class="w-5 h-5 accent-violet-600">
                CT - scan
              </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="mri"
                      class="w-5 h-5 accent-indigo-600">
                MRI
              </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="ultrasound"
                      class="w-5 h-5 accent-cyan-600">
                Ultrasound
              </label>
            </div>
          </div>

      </div>

      <div class="flex justify-between mt-6">
        <button type="button" class="btn-secondary bg-teal-500 hover:bg-teal-400 text-white font-semibold px-8 py-3 rounded-xl shadow transition" onclick="prevStep()">Back</button>
        <button type="button" class="btn-primary bg-teal-500 hover:bg-teal-400 text-white font-semibold px-8 py-3 rounded-xl shadow transition" onclick="nextStep()">Next</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="step hidden" data-step="3">
      <div class="bg-white rounded-2xl p-6 shadow">
        <h3 class="font-semibold mb-4">Triage</h3>

        <div class="flex items-center gap-4 mb-4">
          <div id="triageColor" class="w-10 h-10 rounded-xl bg-gray-300 border"></div>
          <select name="color_code" class="input" onchange="updateTriageColor(this.value)" required>
            <option value="">Select Triage</option>
            <option>White</option>
            <option>Green</option>
            <option>Yellow</option>
            <option>Red</option>
            <option>Black</option>
          </select>
        </div>

        <textarea name="prescription" class="input" rows="3" placeholder="Prescription" required></textarea>
      </div>

      <div class="flex justify-between mt-6">
        <button type="button" class="btn-secondary bg-teal-500 hover:bg-teal-400 text-white font-semibold px-8 py-3 rounded-xl shadow transition" onclick="prevStep()">Back</button>
        <button type="submit" class="btn-primary bg-teal-500 hover:bg-teal-400 text-white font-semibold px-8 py-3 rounded-xl shadow transition">Save Patient</button>
      </div>
    </div>

        </div>
    </div>

    </div>
  </div>
</div>
</form>
<!-- EDIT PATIENT -->
<div id="edit" class="hidden page">
<h2 class="text-2xl font-semibold mb-6">Edit Patient</h2>

<!-- SEARCH -->
<input id="searchEdit"
    placeholder="Search by Patient ID or Name"
    class="input max-w-md mb-6"
    onkeyup="searchPatient()">

<!-- FORM -->
<div id="editForm" class="hidden space-y-6 max-w-3xl">

<div class="bg-white rounded-2xl p-6 shadow">
<h3 class="font-semibold mb-4">Basic Information</h3>
<div class="grid grid-cols-2 gap-4">
<input type="hidden" id="edit_id">

<input id="edit_patient_id" class="input col-span-2" placeholder="Patient ID">
<input id="edit_name" class="input" placeholder="Name">
<input id="edit_surname" class="input" placeholder="Surname">

<select id="edit_sex" class="input">
<option>Male</option>
<option>Female</option>
<option>Other</option>
</select>

<input id="edit_age" type="number" class="input" placeholder="Age">
<input id="edit_height" class="input" placeholder="Height (cm)">
<input id="edit_weight" class="input" placeholder="Weight (kg)">
</div>
</div>

<div class="bg-white rounded-2xl p-6 shadow">
<h3 class="font-semibold mb-4">Medical Information</h3>
<div class="grid grid-cols-2 gap-4">
<input id="edit_chronic" class="input" placeholder="Chronic Disease">
<input id="edit_allergy" class="input" placeholder="Allergy">
<input id="edit_bp" class="input" placeholder="Blood Pressure">
<input id="edit_hr" class="input" placeholder="Heart Rate">
<input id="edit_bt" class="input" placeholder="Blood Type">
</div>

<textarea id="edit_case" class="input mt-4" rows="3" placeholder="Case Description"></textarea>
<textarea id="edit_diag" class="input mt-4" rows="3" placeholder="Diagnosis"></textarea>
        <div>
          <hr class="border-gray-200 my-3">
            <p class="font-medium mb-3">Imaging Required</p>

            <div class="flex gap-6">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="xray"
                      class="w-5 h-5 accent-blue-600">
                X - Ray
              </label>

              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="cbc"
                      class="w-5 h-5 accent-green-600">
                CBC
              </label>

              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="ct_scan"
                      class="w-5 h-5 accent-violet-600">
                CT - scan
              </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="mri"
                      class="w-5 h-5 accent-indigo-600">
                MRI
              </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="imaging[]" value="ultrasound"
                      class="w-5 h-5 accent-cyan-600">
                Ultrasound
              </label>
            </div>
          </div>
</div>

<div class="bg-white rounded-2xl p-6 shadow">
<h3 class="font-semibold mb-4">Triage & Status</h3>

<div class="flex items-center gap-4 mb-4">
<div id="editTriageColor" class="w-10 h-10 rounded-xl border"></div>
<select id="edit_color"
    onchange="updateEditColor(this.value)"
    class="input flex-1">
<option>Red</option>
<option>Yellow</option>
<option>Green</option>
<option>White</option>
<option>Black</option>
</select>
</div>

<textarea id="edit_prescription" class="input mt-4" rows="3" placeholder="Prescription"></textarea>
</div>

<button onclick="saveEdit()"
    class="w-full bg-teal-500 hover:bg-teal-400 text-white font-semibold py-4 rounded-2xl shadow transition">
Save Changes
</button>

</div>
</div>


<!-- STYLES -->
<style>
.nav-btn{
display:flex;gap:12px;align-items:center;width:100%;
padding:12px 16px;border-radius:12px;font-weight:600;
}
.nav-btn:hover{background:rgba(255,255,255,.4);}
.input{
width:100%;padding:12px 16px;border-radius:12px;
border:1px solid #D1D5DB;outline:none;
}
.input:focus{
border-color:#2DD4BF;
box-shadow:0 0 0 2px rgba(45,212,191,.3);
}
.triage{
text-align:center;padding:16px;border-radius:12px;font-weight:600;
}
.triage span{font-size:1.5rem;font-weight:700;}
</style>
<script src="https://unpkg.com/lucide@latest" defer></script>
<script src="{{ url_for('static', filename='script.js') }}" defer></script>

<!-- LOGOUT POPUP -->
<div id="logoutModal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl shadow-lg w-full max-w-sm p-8 text-center">

    <h2 class="text-xl font-semibold mb-4">Confirm Logout</h2>
    <p class="text-gray-600 mb-6">Are you sure you want to logout?</p>

    <div class="flex justify-center gap-4">
      <button onclick="closeLogoutPopup()"
        class="px-6 py-2 rounded-xl border font-semibold hover:bg-gray-100">
        Cancel
      </button>

      <button onclick="logout()"
        class="px-6 py-2 rounded-xl bg-red-500 text-white font-semibold hover:bg-red-400">
        Logout
      </button>
    </div>

  </div>
</div>

</body>
</html>